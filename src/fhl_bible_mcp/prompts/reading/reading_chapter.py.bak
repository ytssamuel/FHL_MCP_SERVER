"""
FHL Bible MCP Server - Reading Chapter Prompt

整章讀經輔助，提供完整的章節研讀體驗
"""

from ..base import PromptTemplate


class ReadingChapterPrompt(PromptTemplate):
    """讀經 - 整章讀經輔助 Prompt"""
    
    def __init__(self):
        super().__init__(
            name="reading_chapter",
            description="引導閱讀和理解整章聖經，包含結構分析、逐段講解和生活應用",
            arguments=[
                {
                    "name": "book",
                    "description": "經卷名稱（中文或英文）",
                    "required": True
                },
                {
                    "name": "chapter",
                    "description": "章數",
                    "required": True
                },
                {
                    "name": "version",
                    "description": "聖經版本代碼（預設：unv）",
                    "required": False
                },
                {
                    "name": "include_audio",
                    "description": "是否包含音訊（預設：false）",
                    "required": False
                }
            ]
        )
    
    def render(
        self,
        book: str = "約翰福音",
        chapter: int = 3,
        version: str = "unv",
        include_audio: bool = False
    ) -> str:
        """
        渲染整章讀經的 prompt
        
        Args:
            book: 經卷名稱（默認：約翰福音）
            chapter: 章數（默認：3）
            version: 聖經版本
            include_audio: 是否包含音訊
            
        Returns:
            渲染後的 prompt
        """
        return f"""
═══════════════════════════════════════════════════════════════════
📖 整章讀經 - {book} 第 {chapter} 章
═══════════════════════════════════════════════════════════════════

歡迎來到整章讀經！讓我們一起深入探索《{book}》第 {chapter} 章的豐富內容。

【讀經資訊】
• 經卷：{book}
• 章節：第 {chapter} 章
• 版本：{version.upper()}
• 音訊：{'✅ 啟用' if include_audio else '❌ 未啟用'}

═══════════════════════════════════════════════════════════════════
步驟 1：章節概覽 🔍
═══════════════════════════════════════════════════════════════════

首先，讓我們獲取這章的完整內容並了解基本資訊。

【獲取經文】：
```
# 取得完整章節
get_bible_chapter(book="{book}", chapter={chapter}, version="{version}")
```

{self._render_audio_section(book, chapter, version) if include_audio else ''}

【章節統計】：
取得經文後，請注意：
• 📊 總節數：____ 節
• 📝 字數統計：約 ____ 字
• ⏱️ 閱讀時間：約 ____ 分鐘（平均每分鐘 200 字）
• 🎧 聆聽時間：約 ____ 分鐘（如有音訊）

【初步觀察】：
在開始詳細研讀前，快速瀏覽全章，注意：
1. 這章的開頭和結尾是什麼？
2. 有沒有重複出現的字詞或概念？
3. 整體的情緒氛圍是什麼？（喜樂/悲傷/警告/應許）
4. 有哪些人物、地點或事件？

═══════════════════════════════════════════════════════════════════
步驟 2：文學結構分析 📐
═══════════════════════════════════════════════════════════════════

了解這章的文學結構，幫助我們掌握作者的思路和重點。

【文學體裁識別】：

這章屬於哪種文學體裁？

📜 **敘事文**（Narrative）：
   • 特徵：講述故事、事件的發展
   • 閱讀重點：人物、情節、衝突、解決
   • 例如：創世記、出埃及記、福音書、使徒行傳

📝 **律法書**（Law）：
   • 特徵：規定、誡命、條例
   • 閱讀重點：命令的內容、目的、原則
   • 例如：利未記、申命記

📖 **詩歌**（Poetry）：
   • 特徵：平行對句、意象豐富、情感濃厚
   • 閱讀重點：意象、情感、對比、漸進
   • 例如：詩篇、箴言、雅歌

📢 **預言**（Prophecy）：
   • 特徵：宣告、警告、應許、異象
   • 閱讀重點：時代背景、對象、信息、應驗
   • 例如：以賽亞書、耶利米書、啟示錄

✉️ **書信**（Epistle）：
   • 特徵：教導、勸勉、問候
   • 閱讀重點：處境、問題、解決方案、應用
   • 例如：羅馬書、哥林多前後書

🎓 **智慧文學**（Wisdom）：
   • 特徵：格言、對比、生活智慧
   • 閱讀重點：原則、對比、實際應用
   • 例如：箴言、傳道書、雅各書

【段落劃分】：

根據內容和主題，將這章分成幾個段落：

段落一（第 ___-___ 節）：
• 中心主題：________________
• 關鍵經節：第 ___ 節
• 簡要說明：________________

段落二（第 ___-___ 節）：
• 中心主題：________________
• 關鍵經節：第 ___ 節
• 簡要說明：________________

段落三（第 ___-___ 節）：
• 中心主題：________________
• 關鍵經節：第 ___ 節
• 簡要說明：________________

（根據實際情況增加段落）

【結構大綱】：

整章的邏輯結構：

```
{book} 第 {chapter} 章 - 結構大綱

I. 引言/背景（第 ___-___ 節）
   A. ________________
   B. ________________

II. 主體/發展（第 ___-___ 節）
    A. ________________
       1. ________________
       2. ________________
    B. ________________
       1. ________________
       2. ________________

III. 高潮/轉折（第 ___-___ 節）
     A. ________________
     B. ________________

IV. 結論/應用（第 ___-___ 節）
    A. ________________
    B. ________________
```

【連貫性分析】：

• 與上一章的連結：________________
• 與下一章的連結：________________
• 在整卷書中的位置和角色：________________

═══════════════════════════════════════════════════════════════════
步驟 3：逐段講解 📚
═══════════════════════════════════════════════════════════════════

現在讓我們逐段深入研讀，了解每段的細節和意義。

【段落研讀框架】：

針對每個段落，使用以下方式研讀：

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【段落 1】第 ___-___ 節
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📌 **中心思想**：
   這段的核心信息是什麼？用一句話總結。

🔑 **關鍵經節**：
   第 ___ 節：「________________」
   
   為什麼這節特別重要？
   • ________________
   • ________________

📖 **經文解析**：

   逐節重點：
   
   • 第 ___ 節：________________
     → 重要字詞：________________
     → 要點說明：________________
   
   • 第 ___ 節：________________
     → 重要字詞：________________
     → 要點說明：________________

💡 **重要字詞研究**：

   使用工具深入了解關鍵字：
   ```
   # 查看原文分析
   get_word_analysis(book="{book}", chapter={chapter}, verse=___, version="{version}")
   
   # 查看 Strong's 編號
   lookup_strongs(testament="nt/ot", strongs_number="___")
   ```

🔗 **相關經文**：

   與這段相關的其他經文：
   ```
   # 搜尋相關主題
   search_bible(keyword="[關鍵字]", version="{version}", limit=5)
   ```

💭 **思考問題**：
   1. ________________？
   2. ________________？
   3. ________________？

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【段落 2】第 ___-___ 節
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

（重複以上框架）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【段落 3】第 ___-___ 節
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

（重複以上框架）

【段落間的連結】：

• 段落 1 → 段落 2：如何發展？________________
• 段落 2 → 段落 3：如何深化？________________
• 整體邏輯：如何串連？________________

═══════════════════════════════════════════════════════════════════
步驟 4：串珠經文（交叉引用）🔗
═══════════════════════════════════════════════════════════════════

找出與本章相關的其他經文，幫助我們更全面地理解神的話語。

【主題串連】：

本章的主要主題：________________

相關經文：

1️⃣ **舊約背景**：
   • _______ ___:___ - ________________
   • _______ ___:___ - ________________
   
   說明：這些經文如何為本章提供背景或預表？

2️⃣ **新約呼應**（如果本章在舊約）：
   • _______ ___:___ - ________________
   • _______ ___:___ - ________________
   
   說明：新約如何應驗或解釋本章？

3️⃣ **平行記載**（如果適用）：
   • _______ ___:___ - ________________
   
   說明：不同作者如何描述同一事件？有什麼獨特角度？

4️⃣ **主題相關**：
   • _______ ___:___ - ________________
   • _______ ___:___ - ________________
   
   說明：聖經其他地方如何論述同一主題？

【使用工具】：
```
# 搜尋主題相關經文
search_bible(keyword="[主題關鍵字]", version="{version}", limit=10)

# 查看特定經文
get_bible_verse(book="___", chapter=___, verse=___, version="{version}")
```

【救恩歷史中的位置】：

• 這章在救恩歷史中扮演什麼角色？
• 如何指向基督？（舊約）
• 如何彰顯基督？（新約）
• 對教會有什麼意義？

═══════════════════════════════════════════════════════════════════
步驟 5：註釋摘要 📝
═══════════════════════════════════════════════════════════════════

參考聖經註釋，了解學者們對這章的解釋和見解。

【查看註釋】：
```
# 取得整章註釋
get_commentary(book="{book}", chapter={chapter}, verse=1)

# 也可以查看特定經節的註釋
get_commentary(book="{book}", chapter={chapter}, verse=___)
```

【註釋重點整理】：

🔍 **解經要點**：

1. **歷史背景**：
   • 寫作時間：________________
   • 歷史事件：________________
   • 文化背景：________________

2. **神學意義**：
   • 關於神的啟示：________________
   • 關於人的真理：________________
   • 關於救恩的信息：________________

3. **難解經文**：
   
   • 第 ___ 節：________________
     → 解釋困難：________________
     → 可能解釋：________________
     → 採納觀點：________________
   
   • 第 ___ 節：________________
     → 解釋困難：________________
     → 可能解釋：________________
     → 採納觀點：________________

4. **不同觀點**：
   
   關於 [議題]：
   • 觀點 A：________________
   • 觀點 B：________________
   • 評估：________________

【搜尋註釋】：
```
# 搜尋特定主題的註釋
search_commentary(keyword="[關鍵字]", limit=5)

# 查看可用的註釋書
list_commentaries()
```

═══════════════════════════════════════════════════════════════════
步驟 6：綜合整理 📋
═══════════════════════════════════════════════════════════════════

將以上的研讀整合起來，形成對這章的完整理解。

【一句話總結】：

用一句話總結這章的核心信息：
「________________」

【三個關鍵要點】：

1️⃣ ________________
   → 支持經文：第 ___ 節
   → 說明：________________

2️⃣ ________________
   → 支持經文：第 ___ 節
   → 說明：________________

3️⃣ ________________
   → 支持經文：第 ___ 節
   → 說明：________________

【神的屬性】：

這章揭示了神的哪些屬性？
• ________________
• ________________
• ________________

【人的處境】：

這章描述了人的什麼處境或需要？
• ________________
• ________________

【福音信息】：

這章如何指向或彰顯福音？
• ________________
• ________________

【金句推薦】：

最值得背誦和默想的經文：

📌 **{book} {chapter}:___ **
「________________」

選擇這節的理由：
• ________________
• ________________

═══════════════════════════════════════════════════════════════════
步驟 7：應用與反思 💫
═══════════════════════════════════════════════════════════════════

最重要的一步：將神的話語應用到生活中。

【個人反思】：

📖 **觀察（Observation）**：
   這章說了什麼？
   • 主要信息：________________
   • 重要細節：________________

💡 **解釋（Interpretation）**：
   這章對原本的讀者意味著什麼？
   • 當時的意義：________________
   • 永恆的真理：________________

🎯 **應用（Application）**：
   這章對我今天的意義是什麼？
   
   【SPECK 應用法】：
   
   • **S**in to confess（要認的罪）：
     ________________
   
   • **P**romise to claim（要領受的應許）：
     ________________
   
   • **E**xample to follow（要效法的榜樣）：
     ________________
   
   • **C**ommand to obey（要遵行的命令）：
     ________________
   
   • **K**nowledge about God（對神的新認識）：
     ________________

【生活應用】：

本週的具體行動計畫：

📅 **今天**：
   我要 ________________

📅 **本週**：
   我要 ________________

📅 **長期**：
   我要培養 ________________ 的習慣/品格

【分享與代禱】：

• 可以與誰分享這章的領受？________________
• 需要為什麼事禱告？________________
• 可以如何服事他人？________________

【禱告回應】：

根據這章的內容，寫下你的禱告：

```
親愛的天父：

感謝祢今天透過《{book}》第 {chapter} 章對我說話...

（根據你的領受，寫下感恩、認罪、祈求）

奉主耶穌基督的名禱告，阿們。
```

═══════════════════════════════════════════════════════════════════
📊 研讀記錄
═══════════════════════════════════════════════════════════════════

【研讀資訊】：
• 研讀日期：___/___/___
• 研讀時間：約 ___ 分鐘
• 研讀深度：□ 快速瀏覽  □ 一般研讀  ☑ 深入研讀

【下次研讀】：
• 建議複習日期：___/___/___（一週後）
• 下一章預習：{book} 第 {chapter + 1} 章

【筆記位置】：
• 實體聖經：第 ___ 頁
• 數位筆記：________________
• 靈修日記：第 ___ 頁

═══════════════════════════════════════════════════════════════════
🎯 延伸學習建議
═══════════════════════════════════════════════════════════════════

想要更深入研讀這章？試試以下方式：

【深度研經】：
• 使用 `study_verse_deep` 深入研讀某節關鍵經文
• 使用 `study_word_original` 研究重要的原文字詞
• 使用 `study_translation_compare` 比較不同譯本

【相關研讀】：
• 閱讀前後章節，了解更大的脈絡
• 研讀同一書卷的其他重要章節
• 查考相關主題的經文

【小組討論】：
• 與小組分享你的領受
• 討論彼此不同的看法
• 一起思考如何應用

【持續學習】：
• 聆聽相關的講道信息
• 閱讀解經書籍
• 參加查經班或主日學

═══════════════════════════════════════════════════════════════════

📖 願神的話語成為你腳前的燈、路上的光！
💡 願聖靈引導你，使你更深認識神、經歷神！
🙏 願你在真理中得自由，在恩典中長進！

═══════════════════════════════════════════════════════════════════
"""
    
    def _render_audio_section(self, book: str, chapter: int, version: str) -> str:
        """渲染音訊部分"""
        return f"""
【音訊選項】：
```
# 查看可用的音訊版本
list_audio_versions()

# 取得音訊及經文
get_audio_chapter_with_text(book="{book}", chapter={chapter}, version="{version}")
```

🎧 **聆聽建議**：
• 第一遍：邊聽邊看經文，熟悉內容
• 第二遍：閉眼聆聽，專注吸收
• 第三遍：跟著朗讀，加深印象

"""

