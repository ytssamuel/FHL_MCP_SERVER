"""
FHL Bible MCP Server - Quick Lookup Prompt

快速查詢經文、書卷或主題
"""

from ..base import PromptTemplate


class QuickLookupPrompt(PromptTemplate):
    """快速查經 Prompt"""
    
    def __init__(self):
        super().__init__(
            name="quick_lookup",
            description="快速查詢經文、書卷或主題，無複雜分析，適合日常使用",
            arguments=[
                {
                    "name": "query",
                    "description": "查詢內容（經節、書卷、主題關鍵字）",
                    "required": True
                },
                {
                    "name": "version",
                    "description": "聖經版本代碼（預設：unv）",
                    "required": False
                }
            ]
        )
    
    def render(self, query: str, version: str = "unv") -> str:
        """
        渲染快速查詢的 prompt
        
        Args:
            query: 查詢內容
            version: 聖經版本代碼
            
        Returns:
            渲染後的 prompt
        """
        return f"""請幫我快速查詢：「{query}」

請按照以下流程進行智能查詢：

═══════════════════════════════════════════════════════════════════
📖 快速查經 - {query}
═══════════════════════════════════════════════════════════════════

【步驟 1：智能解析查詢】

請分析查詢內容並判斷類型：

1️⃣ **經節格式**（如「約翰福音 3:16」、「John 3:16」）
   → 使用 get_bible_verse 查詢
   → 版本：{version}
   
2️⃣ **章節格式**（如「詩篇 23」、「Psalm 23」）
   → 使用 get_bible_chapter 查詢
   → 版本：{version}
   
3️⃣ **書卷格式**（如「腓利門書」、僅限短書卷）
   → 使用 get_bible_book 查詢
   → ⚠️ 僅適用於短書卷（腓利門書、約翰二書、約翰三書、猶大書）
   
4️⃣ **關鍵字搜尋**（如「愛」、「信心」、「平安」）
   → 使用 search_bible 查詢
   → 限制結果：前 5 個最相關的經文
   → 版本：{version}

───────────────────────────────────────────────────────────────────

【步驟 2：顯示結果】

以清晰易讀的方式呈現經文：

▸ **經文內容**
  • 使用適當的格式（章節標題、經文編號）
  • 如果是搜尋結果，顯示每處經文的上下文

▸ **版本資訊**
  • 顯示所使用的聖經版本
  • 如：「和合本 (unv)」

▸ **快速統計**（如適用）
  • 經節數量
  • 字數統計
  • 搜尋結果總數

───────────────────────────────────────────────────────────────────

【步驟 3：提供 URI 連結】

為方便進一步查詢，提供相應的 Resource URI：

📎 **快速訪問連結**：

根據查詢類型提供對應的 URI：
• 單節經文 → bible://verse/{version}/{{book}}/{{chapter}}/{{verse}}
• 整章經文 → bible://chapter/{version}/{{book}}/{{chapter}}
• 搜尋結果 → 每處經文的 bible:// URI

───────────────────────────────────────────────────────────────────

【步驟 4：快速行動建議】

💡 **接下來您可以**：

根據查詢結果，提供相關的後續動作：

1. 🔍 **深入研讀**
   「如果您想深入研究這節經文，請說：
    『請幫我深入研讀 [經文位置]』
    或使用 study_verse prompt」

2. 🎧 **聆聽音訊**
   「如果您想聽這段經文，請說：
    『請給我 [經文位置] 的音訊』
    或使用 get_audio_chapter_with_text 工具」

3. 💬 **查看註釋**
   「如果您想了解專家的解經，請說：
    『請顯示 [經文位置] 的註釋』
    或點擊 commentary://{{book}}/{{chapter}}/{{verse}}」

4. 🔤 **研究原文**
   「如果您想研究原文字義，請說：
    『請分析 [經文位置] 的原文』
    或使用 get_word_analysis 工具」

5. 📊 **比較譯本**
   「如果您想比較不同翻譯，請說：
    『請比較 [經文位置] 的不同譯本』
    或使用 compare_translations prompt」

6. 🔗 **相關經文**
   「如果您想找相關經文，請說：
    『找出與 [主題] 相關的經文』
    或使用 search_bible 工具」

───────────────────────────────────────────────────────────────────

【步驟 5：搜尋優化建議】（僅當是關鍵字搜尋時）

如果搜尋結果太多或太少，提供優化建議：

📊 **搜尋結果統計**：
• 找到 X 處相關經文
• 顯示前 5 處最相關的結果

💡 **優化建議**：

▸ 如果結果太多（>50 處）：
  • 建議使用更具體的關鍵字
  • 建議限定範圍（新約/舊約）
  • 範例：「在新約中搜尋『{query}』」

▸ 如果結果太少（<3 處）：
  • 建議使用相關同義詞
  • 建議擴大搜尋範圍
  • 建議使用主題查經：「使用 search_topic 查詢『{query}』主題」

▸ 如果結果為 0：
  • 檢查拼寫
  • 建議相近的詞彙
  • 建議使用主題聖經資源

═══════════════════════════════════════════════════════════════════

【範例輸出格式】

根據「{query}」的查詢類型，參考以下格式：

┌─────────────────────────────────────────────────────────────────┐
│ 📖 約翰福音 3:16 (和合本)                                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ 神愛世人，甚至將他的獨生子賜給他們，叫一切信他的，             │
│ 不致滅亡，反得永生。                                             │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│ 📎 快速連結：bible://verse/unv/John/3/16                        │
│ 💡 深入研讀：使用 study_verse prompt                            │
│ 💬 查看註釋：commentary://John/3/16                              │
└─────────────────────────────────────────────────────────────────┘

或（關鍵字搜尋）：

┌─────────────────────────────────────────────────────────────────┐
│ 🔍 搜尋結果：「{query}」                                         │
├─────────────────────────────────────────────────────────────────┤
│ 找到 45 處相關經文，顯示前 5 處：                                 │
│                                                                 │
│ 1. 約翰福音 3:16                                                 │
│    神愛世人，甚至將他的獨生子賜給他們...                         │
│    📎 bible://verse/unv/John/3/16                               │
│                                                                 │
│ 2. 羅馬書 5:8                                                    │
│    惟有基督在我們還作罪人的時候為我們死...                       │
│    📎 bible://verse/unv/Rom/5/8                                 │
│                                                                 │
│ [其他結果...]                                                    │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│ 💡 想看更多？使用 search_topic prompt 進行主題研究               │
└─────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════

【注意事項】

✓ 保持簡潔：只提供必要資訊，不做深入分析
✓ 快速響應：優先使用最直接的查詢方式
✓ 引導用戶：提供明確的後續行動建議
✓ 錯誤處理：如果查詢失敗，提供友善的錯誤提示和建議

═══════════════════════════════════════════════════════════════════

請開始執行查詢！
"""
