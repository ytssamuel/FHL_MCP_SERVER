"""éˆä¿®ææ–™ Prompt

ç”Ÿæˆå€‹äººæˆ–å°çµ„éˆä¿®ææ–™ï¼ŒåŒ…å«é»˜æƒ³ã€ç¦±å‘Šå’Œæ‡‰ç”¨ã€‚
"""

from typing import Optional
from ..base import PromptTemplate


class SpecialDevotionalPrompt(PromptTemplate):
    """éˆä¿®ææ–™å°è©±ç¯„æœ¬
    
    æ ¹æ“šç¶“æ–‡ç”Ÿæˆéˆä¿®ææ–™ï¼Œé©ç”¨æ–¼ï¼š
    - å€‹äººéˆä¿®ï¼ˆpersonalï¼‰
    - å°çµ„æŸ¥ç¶“ï¼ˆgroupï¼‰
    - å®¶åº­éˆä¿®ï¼ˆfamilyï¼‰
    
    åŒ…å«å®Œæ•´çš„éˆä¿®æµç¨‹ï¼š
    - é–‹å ´ç¦±å‘Š
    - ç¶“æ–‡é–±è®€
    - èƒŒæ™¯ç°¡ä»‹
    - é‡é»è§€å¯Ÿ
    - é»˜æƒ³å•é¡Œ
    - å¯¦éš›æ‡‰ç”¨
    - ç¦±å‘Šæ–¹å‘
    - é‡‘å¥å¡ç‰‡
    """
    
    def __init__(
        self,
        passage: str = "Psalm 23",
        format: str = "personal",
        duration: str = "medium",
        version: str = "unv"
    ):
        """åˆå§‹åŒ–éˆä¿®ææ–™ Prompt
        
        Args:
            passage: ç¶“æ–‡ï¼ˆç« ç¯€æˆ–æ®µè½ï¼Œå¦‚ "Psalm 23" æˆ– "John 3:16-21"ï¼Œé è¨­ï¼šPsalm 23ï¼‰
            format: éˆä¿®æ ¼å¼
                - personal: å€‹äººéˆä¿®
                - group: å°çµ„æŸ¥ç¶“
                - family: å®¶åº­éˆä¿®
            duration: æ™‚é•·
                - short: çŸ­ï¼ˆ15-20åˆ†é˜ï¼‰
                - medium: ä¸­ï¼ˆ30-40åˆ†é˜ï¼‰
                - long: é•·ï¼ˆ60åˆ†é˜ä»¥ä¸Šï¼‰
            version: è–ç¶“ç‰ˆæœ¬ï¼ˆé è¨­ï¼šunv å’Œåˆæœ¬ï¼‰
        """
        super().__init__(
            name="special_devotional",
            description="æ ¹æ“šç¶“æ–‡ç”Ÿæˆéˆä¿®ææ–™ï¼ŒåŒ…å«é»˜æƒ³ã€ç¦±å‘Šå’Œæ‡‰ç”¨",
            arguments=[
                {"name": "passage", "description": "ç¶“æ–‡ï¼ˆç« ç¯€æˆ–æ®µè½ï¼‰", "required": False},
                {"name": "format", "description": "éˆä¿®æ ¼å¼ (personal/group/family)", "required": False},
                {"name": "duration", "description": "æ™‚é•· (short/medium/long)", "required": False},
                {"name": "version", "description": "è–ç¶“ç‰ˆæœ¬", "required": False}
            ]
        )
        self.passage = passage
        self.format = format
        self.duration = duration
        self.version = version
    
    def render(
        self,
        passage: str = None,
        format: str = None,
        duration: str = None,
        version: str = None
    ) -> str:
        """æ¸²æŸ“éˆä¿®ææ–™
        
        Args:
            passage: ç¶“æ–‡ï¼ˆå¯é¸ï¼Œä½¿ç”¨æ™‚è¦†è“‹åˆå§‹åŒ–å€¼ï¼‰
            format: éˆä¿®æ ¼å¼ï¼ˆå¯é¸ï¼Œä½¿ç”¨æ™‚è¦†è“‹åˆå§‹åŒ–å€¼ï¼‰
            duration: æ™‚é•·ï¼ˆå¯é¸ï¼Œä½¿ç”¨æ™‚è¦†è“‹åˆå§‹åŒ–å€¼ï¼‰
            version: è–ç¶“ç‰ˆæœ¬ï¼ˆå¯é¸ï¼Œä½¿ç”¨æ™‚è¦†è“‹åˆå§‹åŒ–å€¼ï¼‰
        """
        # ä½¿ç”¨å‚³å…¥çš„åƒæ•¸æˆ–åˆå§‹åŒ–æ™‚çš„å€¼
        if passage is not None:
            self.passage = passage
        if format is not None:
            self.format = format
        if duration is not None:
            self.duration = duration
        if version is not None:
            self.version = version
        
        format_info = {
            "personal": {
                "name": "å€‹äººéˆä¿®",
                "icon": "ğŸ™",
                "focus": "å€‹äººèˆ‡ç¥çš„è¦ªå¯†ç›¸äº¤",
                "style": "æ·±åº¦é»˜æƒ³ï¼Œå€‹äººåæ€"
            },
            "group": {
                "name": "å°çµ„æŸ¥ç¶“",
                "icon": "ğŸ‘¥",
                "focus": "è‚¢é«”äº’å‹•ï¼Œå½¼æ­¤é€ å°±",
                "style": "è¨è«–åˆ†äº«ï¼Œå¯¦è¸æ‡‰ç”¨"
            },
            "family": {
                "name": "å®¶åº­éˆä¿®",
                "icon": "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦",
                "focus": "å…¨å®¶å±¬éˆæˆé•·",
                "style": "é©é½¡äº’å‹•ï¼Œå®¶åº­å»ºé€ "
            }
        }
        
        duration_info = {
            "short": {"time": "15-20 åˆ†é˜", "depth": "ç²¾ç°¡", "questions": 2},
            "medium": {"time": "30-40 åˆ†é˜", "depth": "é©ä¸­", "questions": 4},
            "long": {"time": "60+ åˆ†é˜", "depth": "æ·±å…¥", "questions": 6}
        }
        
        fmt = format_info.get(self.format, format_info["personal"])
        dur = duration_info.get(self.duration, duration_info["medium"])
        
        prompt = f"""
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  {fmt['icon']} {fmt['name']}éˆä¿®ææ–™
  FHL Bible MCP Server
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“– ç¶“æ–‡ï¼š{self.passage}
â° æ™‚é•·ï¼š{dur['time']}
ğŸ“š ç‰ˆæœ¬ï¼š{self.version.upper()}
ğŸ¯ ç„¦é»ï¼š{fmt['focus']}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ç¬¬ä¸€æ­¥ï¼šé–‹å ´ç¦±å‘Š
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

"""

        if self.format == "personal":
            prompt += """ğŸ™ **å€‹äººé–‹å ´ç¦±å‘Š**

è¦ªæ„›çš„å¤©çˆ¶ï¼Œ
æ„Ÿè¬ç¥¢é€éè–ç¶“å‘æˆ‘èªªè©±ã€‚
æ±‚ç¥¢æ‰“é–‹æˆ‘å¿ƒéˆçš„çœ¼ç›ï¼Œ
è®“æˆ‘èƒ½æ˜ç™½ç¥¢è©±èªçš„çœŸç†ã€‚
é¡˜è–éˆå…‰ç…§å¼•å°ï¼Œ
ä½¿æˆ‘ä¸åªæ˜¯è½é“ï¼Œä¹Ÿèƒ½è¡Œé“ã€‚
å¥‰ä¸»è€¶ç©ŒåŸºç£çš„åç¦±å‘Šï¼Œé˜¿å€‘ã€‚

ğŸ’¡ **æº–å‚™å¿ƒéˆ**
â€¢ æ‰¾ä¸€å€‹å®‰éœçš„åœ°æ–¹
â€¢ æ”¾ä¸‹æ‰‹æ©Ÿå’Œé›œå¿µ
â€¢ é å‚™ç´™ç­†è¨˜éŒ„æ„Ÿå‹•
â€¢ æ•é–‹å¿ƒè¿æ¥ç¥çš„è©±èª
"""
        elif self.format == "group":
            prompt += """ğŸ‘¥ **å°çµ„é–‹å ´ç¦±å‘Š**

ï¼ˆå»ºè­°ç”±çµ„é•·æˆ–è¼ªæµå¸¶é ˜ç¦±å‘Šï¼‰

è¦ªæ„›çš„å¤©çˆ¶ï¼Œ
æ„Ÿè¬ç¥¢è®“æˆ‘å€‘ä»Šå¤©èƒ½å¤ èšé›†ï¼Œ
ä¸€åŒä¾†åˆ°ç¥¢çš„è©±èªé¢å‰ã€‚
æ±‚ç¥¢çš„éˆé‹è¡Œåœ¨æˆ‘å€‘ç•¶ä¸­ï¼Œ
è³œä¸‹æ‚Ÿæ€§ï¼Œä½¿æˆ‘å€‘æ˜ç™½çœŸç†ã€‚
é¡˜æˆ‘å€‘çš„åˆ†äº«å’Œè¨è«–éƒ½è’™ç¥¢å–œæ‚…ï¼Œ
å½¼æ­¤é€ å°±ï¼Œä¸€åŒæˆé•·ã€‚
å¥‰ä¸»è€¶ç©ŒåŸºç£çš„åç¦±å‘Šï¼Œé˜¿å€‘ã€‚

ğŸ’¡ **å°çµ„é ˆçŸ¥**
â€¢ å½¼æ­¤å°Šé‡ï¼ŒèªçœŸè†è½
â€¢ èª å¯¦åˆ†äº«ï¼Œäº’ç›¸å®ˆå¯†
â€¢ ä¸æ‰¹è©•è«–æ–·
â€¢ æ‰‹æ©ŸéœéŸ³ï¼Œå°ˆå¿ƒåƒèˆ‡
â€¢ é å‚™ç´™ç­†è¨˜éŒ„
"""
        else:  # family
            prompt += """ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ **å®¶åº­éˆä¿®ç¦±å‘Š**

ï¼ˆå¯ç”±å®¶é•·å¸¶é ˜ï¼Œæˆ–è®“å­©å­è¼ªæµç¦±å‘Šï¼‰

è¦ªæ„›çš„å¤©çˆ¶ï¼Œ
è¬è¬ç¥¢æ„›æˆ‘å€‘é€™å€‹å®¶åº­ã€‚
ä»Šå¤©æˆ‘å€‘å…¨å®¶ä¸€èµ·ä¾†è®€è–ç¶“ï¼Œ
æ±‚ç¥¢å¹«åŠ©æˆ‘å€‘æ˜ç™½ç¥¢çš„è©±ï¼Œ
ä¹Ÿå¹«åŠ©æˆ‘å€‘æ¯å€‹äººéƒ½èƒ½å­¸åˆ°é‡è¦çš„åŠŸèª²ã€‚
è®“æˆ‘å€‘çš„å®¶æ›´æœ‰æ„›ï¼Œæ›´æ¦®è€€ç¥¢ã€‚
å¥‰ä¸»è€¶ç©Œçš„åç¦±å‘Šï¼Œé˜¿å€‘ã€‚

ğŸ’¡ **å®¶åº­éˆä¿®å°è²¼å£«**
â€¢ é¸æ“‡å…¨å®¶æ–¹ä¾¿çš„æ™‚é–“
â€¢ ç‡Ÿé€ æº«é¦¨èˆ’é©çš„æ°›åœ
â€¢ é¼“å‹µæ¯å€‹æˆå“¡åƒèˆ‡
â€¢ ä½¿ç”¨é©é½¡çš„èªè¨€
â€¢ å¯æ­é…å°éŠæˆ²æˆ–æ´»å‹•
"""

        prompt += f"""

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ç¬¬äºŒæ­¥ï¼šç¶“æ–‡é–±è®€
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“– **ä»Šæ—¥ç¶“æ–‡ï¼š{self.passage}**

è«‹ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å–å¾—ç¶“æ–‡ï¼š

**æ–¹æ³• 1ï¼šç›´æ¥æŸ¥è©¢**
```
get_bible_chapter æˆ– get_bible_verses
æ›¸å·ï¼š{self._parse_book()}
ç« ç¯€ï¼š{self._parse_chapter()}
ç‰ˆæœ¬ï¼š{self.version}
```

**æ–¹æ³• 2ï¼šä½¿ç”¨ URI**
```
bible://{self.version}/{self._parse_book()}/{self._parse_chapter()}
```

ğŸ“š **å»ºè­°é–±è®€æ–¹å¼**

"""

        if self.duration == "short":
            prompt += """â€¢ éœé»˜é–±è®€ä¸€æ¬¡
â€¢ æ¨™è¨˜æœ‰æ„Ÿå‹•çš„ç¶“ç¯€
"""
        elif self.duration == "long":
            prompt += """â€¢ ç¬¬ä¸€æ¬¡ï¼šå¿«é€Ÿç€è¦½ï¼Œäº†è§£å¤§æ„
â€¢ ç¬¬äºŒæ¬¡ï¼šä»”ç´°é–±è®€ï¼Œæ¨™è¨˜é‡é»
â€¢ ç¬¬ä¸‰æ¬¡ï¼šå¤§è²æœ—è®€ï¼Œé»˜æƒ³å…§åŒ–
â€¢ å¯è†è½éŸ³è¨Šç‰ˆæœ¬ï¼ˆä½¿ç”¨ get_audio_chapter_with_textï¼‰
"""
        else:  # medium
            prompt += """â€¢ ç¬¬ä¸€æ¬¡ï¼šéœé»˜é–±è®€ï¼Œäº†è§£å¤§æ„
â€¢ ç¬¬äºŒæ¬¡ï¼šå¤§è²æœ—è®€æˆ–è†è½éŸ³è¨Š
â€¢ æ¨™è¨˜æœ‰æ„Ÿå‹•æˆ–ç–‘å•çš„ç¶“ç¯€
"""

        if self.format == "group":
            prompt += """
ğŸ’¡ **å°çµ„é–±è®€å»ºè­°**
â€¢ è¼ªæµæœ—è®€ï¼ˆæ¯äººè®€ 2-3 ç¯€ï¼‰
â€¢ æˆ–ç”±ä¸€äººæœ—è®€ï¼Œå…¶ä»–äººè·Ÿè®€
â€¢ é¼“å‹µä¸åŒçµ„å“¡ç”¨ä¸åŒèªæ°£æœ—è®€
"""
        elif self.format == "family":
            prompt += """
ğŸ’¡ **å®¶åº­é–±è®€å»ºè­°**
â€¢ çˆ¶æ¯å…ˆè®€ä¸€æ¬¡
â€¢ è®“å­©å­ä¹Ÿåƒèˆ‡æœ—è®€ï¼ˆå¯è®€éƒ¨åˆ†ç¶“ç¯€ï¼‰
â€¢ å¯ç”¨å•ç­”æ–¹å¼ç¢ºèªå­©å­ç†è§£
â€¢ å¹´å¹¼å­©å­å¯ç”¨å…’ç«¥è–ç¶“ç‰ˆæœ¬æ­é…
"""

        prompt += f"""

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ç¬¬ä¸‰æ­¥ï¼šèƒŒæ™¯ç°¡ä»‹
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

è«‹ä½¿ç”¨ä»¥ä¸‹å·¥å…·äº†è§£ç¶“æ–‡èƒŒæ™¯ï¼š

ğŸ“š **æ›¸å·è³‡è¨Š**
```
ä½¿ç”¨ info://books æŸ¥è©¢ {self._parse_book()} çš„èƒŒæ™¯
```

ğŸ“– **ç¶“æ–‡èƒŒæ™¯**ï¼ˆ1-2 æ®µç°¡ä»‹ï¼‰

è«‹æä¾›ä»¥ä¸‹è³‡è¨Šï¼š
1. é€™æ®µç¶“æ–‡çš„æ­·å²æ–‡åŒ–èƒŒæ™¯
2. ä½œè€…å¯«ä½œçš„ç›®çš„å’Œå°è±¡
3. é€™æ®µç¶“æ–‡åœ¨å…¨æ›¸ä¸­çš„ä½ç½®
4. èˆ‡æˆ‘å€‘ä»Šå¤©çš„é—œè¯

ğŸ’¡ èƒŒæ™¯ç°¡ä»‹æ‡‰ï¼š
â€¢ ç°¡æ½”æ˜“æ‡‚ï¼ˆç‰¹åˆ¥æ˜¯ {fmt['name']}ï¼‰
â€¢ å¹«åŠ©ç†è§£ç¶“æ–‡å«ç¾©
â€¢ ä¸å®œéé•·ï¼Œé¿å…å–§è³“å¥ªä¸»

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ç¬¬å››æ­¥ï¼šé‡é»è§€å¯Ÿ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

è«‹å”åŠ©è§€å¯Ÿç¶“æ–‡ä¸­çš„é‡è¦å…ƒç´ ï¼š

ğŸ” **è§€å¯Ÿå•é¡Œ**ï¼ˆå¯ä½¿ç”¨ get_word_analysis å’Œ lookup_strongsï¼‰

1. **é—œéµå­—è©**
   â€¢ å“ªäº›å­—è©é‡è¤‡å‡ºç¾ï¼Ÿ
   â€¢ å“ªäº›å­—è©ç‰¹åˆ¥é‡è¦ï¼Ÿ
   â€¢ åŸæ–‡æœ‰ä»€éº¼ç‰¹æ®Šå«ç¾©ï¼Ÿ

2. **äººç‰©æˆ–è§’è‰²**
   â€¢ ç¶“æ–‡ä¸­æœ‰å“ªäº›äººç‰©ï¼Ÿ
   â€¢ ä»–å€‘åšäº†ä»€éº¼ï¼Ÿ
   â€¢ ä»–å€‘çš„æ…‹åº¦æˆ–åæ‡‰å¦‚ä½•ï¼Ÿ

3. **é‡è¦å‹•ä½œæˆ–äº‹ä»¶**
   â€¢ ç™¼ç”Ÿäº†ä»€éº¼äº‹ï¼Ÿ
   â€¢ äº‹ä»¶çš„å› æœé—œä¿‚ï¼Ÿ
   â€¢ çµæœå¦‚ä½•ï¼Ÿ

4. **å°æ¯”æˆ–æ¯”è¼ƒ**
   â€¢ æœ‰å“ªäº›å°æ¯”ï¼ˆå…‰èˆ‡æš—ã€ç”Ÿèˆ‡æ­»ç­‰ï¼‰ï¼Ÿ
   â€¢ æœ‰ä»€éº¼æ¯”å–»æˆ–è±¡å¾µï¼Ÿ

5. **æ‡‰è¨±æˆ–å‘½ä»¤**
   â€¢ ç¥çš„æ‡‰è¨±æ˜¯ä»€éº¼ï¼Ÿ
   â€¢ ç¥çš„å‘½ä»¤æ˜¯ä»€éº¼ï¼Ÿ
   â€¢ å°æˆ‘å€‘çš„è¦æ±‚ï¼Ÿ

ğŸ“ **é‡é»æ‘˜è¦**ï¼ˆ3-5 é»ï¼‰

è«‹æ•´ç†æœ¬æ®µç¶“æ–‡çš„ä¸»è¦ä¿¡æ¯ï¼š
â€¢ ç¬¬ä¸€è¦é»ï¼š____________
â€¢ ç¬¬äºŒè¦é»ï¼š____________
â€¢ ç¬¬ä¸‰è¦é»ï¼š____________
ï¼ˆå¦‚æœ‰å¿…è¦å¯å¢åŠ è‡³ 5 é»ï¼‰

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ç¬¬äº”æ­¥ï¼šé»˜æƒ³å•é¡Œ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

"""

        # æ ¹æ“šæ ¼å¼æä¾›ä¸åŒçš„å•é¡Œé¡å‹
        if self.format == "personal":
            prompt += f"""ğŸ’­ **å€‹äººé»˜æƒ³å•é¡Œ**ï¼ˆ{dur['questions']} å€‹ï¼‰

è«‹æ€è€ƒä»¥ä¸‹å•é¡Œï¼Œèª å¯¦åœ°åœ¨ç¥é¢å‰çœå¯Ÿï¼š

1. **ç†è§£å±¤é¢**
   â€¢ é€™æ®µç¶“æ–‡çš„æ ¸å¿ƒä¿¡æ¯æ˜¯ä»€éº¼ï¼Ÿ
   â€¢ æˆ‘æ˜¯å¦çœŸæ­£æ˜ç™½ç¥è¦èªªçš„è©±ï¼Ÿ

2. **å€‹äººåæ€**
   â€¢ é€™æ®µç¶“æ–‡å°æˆ‘èªªäº†ä»€éº¼ï¼Ÿ
   â€¢ ç¥é€éé€™æ®µç¶“æ–‡è¦å…‰ç…§æˆ‘å“ªå€‹éƒ¨åˆ†ï¼Ÿ
   â€¢ æˆ‘ç”Ÿå‘½ä¸­å“ªè£¡éœ€è¦æ”¹è®Šï¼Ÿ

3. **å¯¦éš›æ‡‰ç”¨**
   â€¢ æˆ‘å¯ä»¥å¦‚ä½•å›æ‡‰ç¥çš„è©±ï¼Ÿ
   â€¢ ä»Šå¤©æˆ‘è¦æ¡å–ä»€éº¼å…·é«”è¡Œå‹•ï¼Ÿ
   â€¢ æˆ‘éœ€è¦å‘èª°é“æ­‰ã€é¥’æ•æˆ–å’Œå¥½ï¼Ÿ

4. **ä¿¡å¿ƒæ“ç·´**
   â€¢ é€™æ®µç¶“æ–‡å¦‚ä½•å …å›ºæˆ‘çš„ä¿¡å¿ƒï¼Ÿ
   â€¢ æˆ‘è¦å¦‚ä½•æ›´ä¿¡é ç¥ï¼Ÿ
"""
        elif self.format == "group":
            prompt += f"""ğŸ’¬ **å°çµ„è¨è«–å•é¡Œ**ï¼ˆ{dur['questions']} å€‹ï¼‰

è«‹é€é¡Œè¨è«–ï¼Œé¼“å‹µæ¯ä½çµ„å“¡åˆ†äº«ï¼š

1. **ç ´å†°å•é¡Œ**ï¼ˆè¼•é¬†é–‹å ´ï¼‰
   â€¢ é€™æ®µç¶“æ–‡å“ªä¸€ç¯€æœ€è§¸å‹•ä½ ï¼Ÿç‚ºä»€éº¼ï¼Ÿ
   â€¢ æœ‰æ²’æœ‰ä¸æ˜ç™½çš„åœ°æ–¹ï¼Ÿ

2. **ç†è§£å•é¡Œ**
   â€¢ é€™æ®µç¶“æ–‡çš„èƒŒæ™¯å’Œå«ç¾©æ˜¯ä»€éº¼ï¼Ÿ
   â€¢ å°ç•¶æ™‚çš„è®€è€…æœ‰ä»€éº¼æ„ç¾©ï¼Ÿ

3. **æ‡‰ç”¨å•é¡Œ**
   â€¢ é€™æ®µç¶“æ–‡å°æˆ‘å€‘ä»Šå¤©æœ‰ä»€éº¼æ„ç¾©ï¼Ÿ
   â€¢ æˆ‘å€‘å¯ä»¥å¦‚ä½•å¯¦è¸ï¼Ÿ

4. **åˆ†äº«è¦‹è­‰**
   â€¢ æœ‰æ²’æœ‰äººæ›¾ç¶“ç¶“æ­·éé¡ä¼¼çš„äº‹ï¼Ÿ
   â€¢ ç¥å¦‚ä½•åœ¨ä½ ç”Ÿå‘½ä¸­æˆå°±ç¥‚çš„è©±ï¼Ÿ

5. **è¡Œå‹•å•é¡Œ**
   â€¢ æœ¬é€±æˆ‘å€‘å¯ä»¥åšä»€éº¼å…·é«”è¡Œå‹•ï¼Ÿ
   â€¢ æˆ‘å€‘å¦‚ä½•å½¼æ­¤å®ˆæœ›ï¼Œäº’ç›¸å¹«åŠ©ï¼Ÿ

ğŸ’¡ **çµ„é•·æç¤º**
â€¢ æŒæ¡æ™‚é–“ï¼Œé¿å…é›¢é¡Œ
â€¢ é¼“å‹µè¼ƒå®‰éœçš„çµ„å“¡ç™¼è¨€
â€¢ åˆ†äº«è¦çœŸå¯¦ï¼Œä¸è¦å±¬éˆè¡“èªå †ç Œ
â€¢ å®ˆå¯†åŸå‰‡ï¼šå°çµ„å…§çš„åˆ†äº«ä¸å¤–å‚³
"""
        else:  # family
            prompt += f"""ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ **å®¶åº­è¨è«–å•é¡Œ**ï¼ˆ{dur['questions']} å€‹ï¼Œé©é½¡èª¿æ•´ï¼‰

è«‹å…¨å®¶ä¸€èµ·è¨è«–ï¼Œé¼“å‹µæ¯å€‹äººåƒèˆ‡ï¼š

1. **çµ¦å°æœ‹å‹**ï¼ˆç°¡å–®å…·é«”ï¼‰
   â€¢ ä»Šå¤©çš„è–ç¶“æ•…äº‹/ç¶“æ–‡åœ¨èªªä»€éº¼ï¼Ÿ
   â€¢ ä½ æœ€å–œæ­¡å“ªä¸€å¥è©±ï¼Ÿç‚ºä»€éº¼ï¼Ÿ
   â€¢ ä½ è¦ºå¾—ç¥è¦æˆ‘å€‘æ€éº¼åšï¼Ÿ

2. **çµ¦é’å°‘å¹´**ï¼ˆè²¼è¿‘ç”Ÿæ´»ï¼‰
   â€¢ é€™æ®µç¶“æ–‡è·Ÿä½ çš„ç”Ÿæ´»æœ‰ä»€éº¼é—œä¿‚ï¼Ÿ
   â€¢ åœ¨å­¸æ ¡æˆ–æœ‹å‹ä¸­ï¼Œä½ å¯ä»¥æ€éº¼æ‡‰ç”¨ï¼Ÿ
   â€¢ æœ‰æ²’æœ‰é‡åˆ°ä»€éº¼æŒ‘æˆ°ï¼Ÿ

3. **çµ¦çˆ¶æ¯**ï¼ˆæ·±å…¥åæ€ï¼‰
   â€¢ æˆ‘å€‘å¦‚ä½•åœ¨å®¶ä¸­æ´»å‡ºé€™æ®µç¶“æ–‡çš„æ•™å°ï¼Ÿ
   â€¢ æˆ‘å€‘çš„å®¶åº­å¯ä»¥å¦‚ä½•æ›´æ¦®è€€ç¥ï¼Ÿ
   â€¢ æˆ‘å€‘è¦ç‚ºå®¶äººç¦±å‘Šä»€éº¼ï¼Ÿ

4. **å…¨å®¶è¨è«–**
   â€¢ æˆ‘å€‘å®¶å¯ä»¥ä¸€èµ·åšä»€éº¼ï¼Ÿ
   â€¢ æœ¬é€±çš„å®¶åº­ç›®æ¨™æ˜¯ä»€éº¼ï¼Ÿ

ğŸ’¡ **å®¶é•·æç¤º**
â€¢ ç”¨å­©å­è½å¾—æ‡‚çš„èªè¨€
â€¢ è®šç¾å­©å­çš„åƒèˆ‡å’Œåˆ†äº«
â€¢ ä¸è¦èªªæ•™ï¼Œè€Œæ˜¯å¼•å°æ€è€ƒ
â€¢ ä»¥èº«ä½œå‰‡ï¼Œåšæ¦œæ¨£
"""

        prompt += """

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ç¬¬å…­æ­¥ï¼šå¯¦éš›æ‡‰ç”¨
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ **ACTS æ‡‰ç”¨æ³•**

è«‹æ€è€ƒå¦‚ä½•å°‡ç¶“æ–‡æ‡‰ç”¨åˆ°ç”Ÿæ´»ä¸­ï¼š

**A - Adorationï¼ˆæ•¬æ‹œè®šç¾ï¼‰**
â€¢ é€™æ®µç¶“æ–‡è®“æˆ‘èªè­˜ç¥çš„å“ªäº›å±¬æ€§ï¼Ÿ
â€¢ æˆ‘è¦å¦‚ä½•è®šç¾æ•¬æ‹œç¥‚ï¼Ÿ

**C - Confessionï¼ˆèªç½ªæ‚”æ”¹ï¼‰**
â€¢ é€™æ®µç¶“æ–‡å…‰ç…§æˆ‘å“ªäº›ç½ªæˆ–è»Ÿå¼±ï¼Ÿ
â€¢ æˆ‘éœ€è¦å‘ç¥èªç½ªæ‚”æ”¹ä»€éº¼ï¼Ÿ

**T - Thanksgivingï¼ˆæ„Ÿæ©ï¼‰**
â€¢ æˆ‘è¦ç‚ºä»€éº¼æ„Ÿè¬ç¥ï¼Ÿ
â€¢ ç¥éå»å¦‚ä½•æ©å¾…æˆ‘ï¼Ÿ

**S - Supplicationï¼ˆç¥ˆæ±‚ï¼‰**
â€¢ æˆ‘è¦å‘ç¥ç¥ˆæ±‚ä»€éº¼ï¼Ÿ
â€¢ æˆ‘è¦ç‚ºèª°ä»£ç¦±ï¼Ÿ

ğŸ’¡ **è¡Œå‹•è¨ˆåŠƒ**ï¼ˆSMART åŸå‰‡ï¼‰

è«‹åˆ¶å®šä¸€å€‹å…·é«”å¯è¡Œçš„è¡Œå‹•è¨ˆåŠƒï¼š

â€¢ **Specific**ï¼ˆå…·é«”ï¼‰ï¼šæˆ‘è¦åšä»€éº¼ï¼Ÿ
  ä¾‹ï¼š________________

â€¢ **Measurable**ï¼ˆå¯è¡¡é‡ï¼‰ï¼šå¦‚ä½•çŸ¥é“æˆ‘åšåˆ°äº†ï¼Ÿ
  ä¾‹ï¼š________________

â€¢ **Achievable**ï¼ˆå¯é”æˆï¼‰ï¼šé€™æ˜¯å¦å¯¦éš›å¯è¡Œï¼Ÿ
  ä¾‹ï¼š________________

â€¢ **Relevant**ï¼ˆç›¸é—œï¼‰ï¼šèˆ‡ç¶“æ–‡ä¿¡æ¯ç›¸é—œ
  ä¾‹ï¼š________________

â€¢ **Time-bound**ï¼ˆæœ‰æ™‚é™ï¼‰ï¼šä»€éº¼æ™‚å€™å®Œæˆï¼Ÿ
  ä¾‹ï¼šæœ¬é€±å…§ï¼æœ¬æœˆå…§

"""

        if self.format == "group":
            prompt += """
ğŸ“‹ **å°çµ„è¡Œå‹•ç´„å®š**

å°çµ„å¯ä»¥ä¸€èµ·ï¼š
â€¢ é¸å®šä¸€å€‹å…±åŒçš„è¡Œå‹•ç›®æ¨™
â€¢ å½¼æ­¤ç£ä¿ƒï¼Œäº’ç›¸ä»£ç¦±
â€¢ ä¸‹æ¬¡èšæœƒåˆ†äº«å¯¦è¸å¿ƒå¾—
â€¢ è¦‹è­‰ç¥çš„ä½œç‚º
"""
        elif self.format == "family":
            prompt += """
ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ **å®¶åº­è¡Œå‹•è¨ˆåŠƒ**

å…¨å®¶å¯ä»¥ä¸€èµ·ï¼š
â€¢ æ±ºå®šä¸€å€‹å®¶åº­å¯¦è¸ç›®æ¨™
â€¢ è£½ä½œæé†’å¡æˆ–æµ·å ±
â€¢ æ¯å¤©äº’ç›¸é¼“å‹µ
â€¢ é€±æœ«ä¸€èµ·å›é¡§åˆ†äº«
"""

        prompt += f"""

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ç¬¬ä¸ƒæ­¥ï¼šç¦±å‘Šæ–¹å‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ™ **æ ¹æ“šç¶“æ–‡ç¦±å‘Š**

è«‹æ ¹æ“šé€™æ®µç¶“æ–‡çš„å…§å®¹ç¦±å‘Šï¼š

**1. ç‚ºè‡ªå·±ç¦±å‘Š**
â€¢ æ±‚ç¥å¹«åŠ©æˆ‘æ˜ç™½ä¸¦éµè¡Œç¥‚çš„è©±
â€¢ æ±‚è–éˆè³œåŠ›é‡æ´»å‡ºçœŸç†
â€¢ æ±‚ç¥æ”¹è®Šæˆ‘çš„ç”Ÿå‘½

**2. ç‚ºå®¶äººç¦±å‘Š**
â€¢ ï¼ˆç‚ºé…å¶ã€çˆ¶æ¯ã€å…’å¥³ã€æ‰‹è¶³ç¦±å‘Šï¼‰
â€¢ æ±‚ç¥ç¥ç¦ä¿å®ˆå®¶äºº
â€¢ æ±‚ç¥åœ¨å®¶äººå¿ƒä¸­å‹•å·¥

**3. ç‚ºæ•™æœƒç¦±å‘Š**
â€¢ ç‚ºç‰§è€…å‚³é“åŒå·¥
â€¢ ç‚ºè‚¢é«”é—œä¿‚
â€¢ ç‚ºæ•™æœƒäº‹å·¥

**4. ç‚ºç¤¾æœƒç¦±å‘Š**
â€¢ ç‚ºåœ‹å®¶é ˜è¢–
â€¢ ç‚ºç¤¾æœƒå…¬ç¾©
â€¢ ç‚ºç¦éŸ³å»£å‚³

"""

        if self.format == "personal":
            prompt += """
ğŸ’¡ **å€‹äººç¦±å‘Šå»ºè­°**
â€¢ å®‰éœåœ¨ç¥é¢å‰
â€¢ èª å¯¦å‚¾å¿ƒåæ„
â€¢ å¯å¯«ä¸‹ç¦±å‘Šæ—¥è¨˜
â€¢ ç­‰å€™ç¥çš„å›æ‡‰
"""
        elif self.format == "group":
            prompt += """
ğŸ’¡ **å°çµ„ç¦±å‘Šå»ºè­°**
â€¢ åˆ†äº«ä»£ç¦±äº‹é …ï¼ˆå½¼æ­¤å®ˆå¯†ï¼‰
â€¢ å¯åˆ†å°çµ„ 2-3 äººä¸€èµ·ç¦±å‘Š
â€¢ æˆ–åœåœˆç«™ç«‹ï¼Œå½¼æ­¤æŒ‰æ‰‹ç¦±å‘Š
â€¢ æœ€å¾Œç”±çµ„é•·ä½œç¸½çµç¦±å‘Š
"""
        else:  # family
            prompt += """
ğŸ’¡ **å®¶åº­ç¦±å‘Šå»ºè­°**
â€¢ å¯åœåœˆç‰½æ‰‹ä¸€èµ·ç¦±å‘Š
â€¢ è®“æ¯å€‹å®¶äººéƒ½åƒèˆ‡ç¦±å‘Š
â€¢ å°æœ‹å‹å¯ç¦±å‘Šç°¡å–®çš„è©±
â€¢ çˆ¶æ¯ç‚ºå­©å­ç¥ç¦ç¦±å‘Š
"""

        prompt += f"""

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ç¬¬å…«æ­¥ï¼šé‡‘å¥å¡ç‰‡
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‡ **æœ¬æ—¥é‡‘å¥**

å¾ {self.passage} ä¸­é¸å‡ºä¸€ç¯€é‡‘å¥èƒŒèª¦ï¼š

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                               â•‘
â•‘    ï¼ˆè«‹å¾ç¶“æ–‡ä¸­é¸å‡ºä¸€ç¯€æ ¸å¿ƒç¶“æ–‡ï¼‰                â•‘
â•‘                                               â•‘
â•‘    ã€Œ________________________________ã€        â•‘
â•‘                                               â•‘
â•‘                 - {self.passage}              â•‘
â•‘                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ’¡ **è¨˜æ†¶é‡‘å¥å»ºè­°**

è«‹ä½¿ç”¨ search_bible æ‰¾å‡ºç›¸é—œç¶“æ–‡ï¼š
â€¢ èˆ‡é€™å€‹ä¸»é¡Œç›¸é—œçš„å…¶ä»–ç¶“æ–‡
â€¢ å¯ä¸²é€£è¨˜æ†¶

èƒŒèª¦æ–¹æ³•ï¼š
â€¢ å¯«åœ¨å¡ç‰‡ä¸Šï¼Œæ”¾åœ¨å¸¸çœ‹åˆ°çš„åœ°æ–¹
â€¢ è¨­ç‚ºæ‰‹æ©Ÿæ¡Œå¸ƒæˆ–æé†’
â€¢ æ¯å¤©è¤‡èª¦ 3 æ¬¡
â€¢ èˆ‡å®¶äººæˆ–å°çµ„å½¼æ­¤èƒŒèª¦

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ“ éˆä¿®ç­†è¨˜
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

è«‹è¨˜éŒ„ä»Šå¤©çš„æ”¶ç©«ï¼š

**ä»Šæ—¥é ˜å—**ï¼š
_________________________________________________
_________________________________________________

**æ„Ÿå‹•ä¹‹è™•**ï¼š
_________________________________________________
_________________________________________________

**éœ€è¦æ”¹è®Š**ï¼š
_________________________________________________
_________________________________________________

**ç¦±å‘Šäº‹é …**ï¼š
_________________________________________________
_________________________________________________

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€å·¥å…·å¿«é€Ÿåƒè€ƒã€‘

æŸ¥è©¢ç¶“æ–‡ï¼š
â€¢ get_bible_chapter - å–å¾—æ•´ç« 
â€¢ get_bible_verses - å–å¾—ç¶“æ–‡ç¯„åœ  
â€¢ URI: bible://{self.version}/{self._parse_book()}/...

è†è½éŸ³è¨Šï¼š
â€¢ list_audio_versions - åˆ—å‡ºéŸ³è¨Šç‰ˆæœ¬
â€¢ get_audio_chapter_with_text - å–å¾—éŸ³è¨Šæœ—è®€

åŸæ–‡ç ”ç©¶ï¼š
â€¢ get_word_analysis - å­—è©åˆ†æ
â€¢ lookup_strongs - Strong's å­—å…¸

æœå°‹ç›¸é—œç¶“æ–‡ï¼š
â€¢ search_bible - æœå°‹é—œéµå­—

æŸ¥è©¢è¨»é‡‹ï¼š
â€¢ get_commentary - å–å¾—è¨»é‡‹

æ›¸å·è³‡è¨Šï¼š
â€¢ info://books - æ›¸å·ç°¡ä»‹

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ•Šï¸ é¡˜ç¥çš„è©±èªæˆç‚ºä½ è…³å‰çš„ç‡ˆï¼Œè·¯ä¸Šçš„å…‰ï¼

"æƒŸå–œæ„›è€¶å’Œè¯çš„å¾‹æ³•ï¼Œæ™å¤œæ€æƒ³ï¼Œé€™äººä¾¿ç‚ºæœ‰ç¦ï¼"
                              ï¼ˆè©©ç¯‡ 1:2ï¼‰

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""
        
        return prompt.strip()
    
    def _parse_book(self) -> str:
        """è§£ææ›¸å·åç¨±"""
        parts = self.passage.split()
        if parts:
            # è™•ç†å¦‚ "1 John" æˆ– "Psalm 23"
            if parts[0].isdigit() and len(parts) > 1:
                return parts[0] + parts[1]
            return parts[0]
        return "John"
    
    def _parse_chapter(self) -> str:
        """è§£æç« æ•¸"""
        import re
        match = re.search(r'(\d+)', self.passage.split()[-1])
        if match:
            return match.group(1)
        return "1"
