# P1-6 search_bible åƒæ•¸é©—è­‰ä¿®å¾©å ±å‘Š

**å•é¡Œç·¨è™Ÿ**: P1-6  
**å•é¡Œæ¨™é¡Œ**: search_bible çš„ greek_number/hebrew_number åƒæ•¸é©—è­‰å¤±æ•—  
**ç™¼ç¾æ—¥æœŸ**: 2025-11-05  
**ä¿®å¾©æ—¥æœŸ**: 2025-11-05  
**å„ªå…ˆç´š**: P1 (é«˜å„ªå…ˆç´š)

---

## ğŸ“‹ å•é¡Œæè¿°

### ç—‡ç‹€

ç”¨æˆ¶åœ¨äºŒæ¬¡å›æ­¸æ¸¬è©¦ä¸­ç™¼ç¾ï¼š

```python
# è«‹æ±‚
search_bible({
    "query": "G1344",
    "scope": "nt",
    "search_type": "greek_number",
    "version": "unv"
})

# è¿”å›
"Your input to the tool was invalid (must be equal to one of the allowed values)"
```

**é æœŸè¡Œç‚º**: æ‡‰è©²è¿”å› G1344 (Î´Î¹ÎºÎ±Î¹ÏŒÏ‰, ç¨±ç¾©) åœ¨æ–°ç´„ä¸­çš„æ‰€æœ‰å‡ºç¾ä½ç½®

**å¯¦éš›è¡Œç‚º**: åƒæ•¸é©—è­‰å¤±æ•—ï¼ŒMCP å·¥å…·æ‹’çµ•åŸ·è¡Œ

---

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### å•é¡Œæ ¹æº

**server.py ç¬¬ 191 è¡Œ** çš„ MCP å·¥å…·å®šç¾©èˆ‡ **search.py å¯¦éš›å¯¦ç¾** ä¸ä¸€è‡´ï¼š

```python
# âŒ server.py (éŒ¯èª¤)
Tool(
    name="search_bible",
    inputSchema={
        "properties": {
            "search_type": {
                "enum": ["keyword", "greek", "hebrew"],  # éŒ¯èª¤ï¼
                ...
            }
        }
    }
)

# âœ… search.py (æ­£ç¢ºå¯¦ç¾)
async def search_bible(search_type: str = "keyword", ...):
    search_type_map = {
        "keyword": 0,
        "greek_number": 1,      # æ­£ç¢ºï¼
        "hebrew_number": 2,     # æ­£ç¢ºï¼
    }
```

### å½±éŸ¿ç¯„åœ

- **å—å½±éŸ¿å·¥å…·**: `search_bible` çš„åŸæ–‡ç·¨è™Ÿæœå°‹åŠŸèƒ½
- **å—å½±éŸ¿åƒæ•¸**: `search_type` çš„ `greek_number` å’Œ `hebrew_number` å€¼
- **ç”¨æˆ¶å½±éŸ¿**: ç„¡æ³•ä½¿ç”¨åŸæ–‡ç·¨è™Ÿæœå°‹è–ç¶“ï¼ˆå¦‚ G1344, H430ï¼‰
- **åŠŸèƒ½ç‹€æ…‹**: å¯¦ç¾æ­£ç¢ºä½† MCP ä»‹é¢å®šç¾©éŒ¯èª¤ï¼Œå°è‡´åƒæ•¸é©—è­‰å¤±æ•—

---

## âœ… ä¿®å¾©æ–¹æ¡ˆ

### ä¿®æ”¹å…§å®¹

**æ–‡ä»¶**: `src/fhl_bible_mcp/server.py`

**ä¿®æ”¹å‰**:
```python
"search_type": {
    "type": "string",
    "enum": ["keyword", "greek", "hebrew"],
    "description": "æœå°‹é¡å‹ï¼ˆkeyword=é—œéµå­—, greek=å¸Œè‡˜æ–‡ç·¨è™Ÿ, hebrew=å¸Œä¼¯ä¾†æ–‡ç·¨è™Ÿï¼‰"
}
```

**ä¿®æ”¹å¾Œ**:
```python
"search_type": {
    "type": "string",
    "enum": ["keyword", "greek_number", "hebrew_number"],
    "description": "æœå°‹é¡å‹ï¼ˆkeyword=é—œéµå­—, greek_number=å¸Œè‡˜æ–‡ç·¨è™Ÿ, hebrew_number=å¸Œä¼¯ä¾†æ–‡ç·¨è™Ÿï¼‰"
}
```

### ä¿®å¾©åŸç†

1. **çµ±ä¸€å‘½å**: å°‡ MCP å·¥å…·å®šç¾©çš„æšèˆ‰å€¼èˆ‡å¯¦éš›å‡½æ•¸å¯¦ç¾çš„ `search_type_map` ä¿æŒä¸€è‡´
2. **ä¿æŒèªç¾©**: `greek_number` å’Œ `hebrew_number` æ›´æ¸…æ¥šåœ°è¡¨é”åƒæ•¸å«ç¾©ï¼ˆç·¨è™Ÿæœå°‹ï¼‰
3. **å‘å¾Œå…¼å®¹**: ä¸å½±éŸ¿ç¾æœ‰ `keyword` é¡å‹çš„æœå°‹åŠŸèƒ½

---

## ğŸ§ª æ¸¬è©¦é©—è­‰

### æ¸¬è©¦æ–‡ä»¶

å‰µå»º `tests/test_search_bible_numbers.py` åŒ…å« 5 å€‹æ¸¬è©¦ç”¨ä¾‹ï¼š

### æ¸¬è©¦çµæœ

```bash
âœ… test_greek_number_g1344_basic PASSED
   æ‰¾åˆ° 35 è™• G1344 å‡ºç¾
   å‰ 5 è™•: Matt 11:19, Matt 12:37, Luke 7:29, Luke 7:35, Luke 10:29

âœ… test_hebrew_number_h430_basic PASSED
   æ‰¾åˆ° 20 è™• H430 å‡ºç¾
   å‰ 5 è™•: Gen 1:1, Gen 1:2, Gen 1:3, Gen 1:4, Gen 1:5

âœ… test_search_type_parameter_validation PASSED
   æ‰€æœ‰ search_type åƒæ•¸é©—è­‰é€šé

âœ… test_greek_number_comprehensive_verses PASSED
   åœ¨ 35 è™•çµæœä¸­æ‰¾åˆ° 5/16 è™•é æœŸç¶“æ–‡

âœ… test_verse_content_quality PASSED
   é©—è­‰ 10 ç­†çµæœçš„å…§å®¹è³ªé‡ï¼Œå…¨éƒ¨é€šé

ğŸ‰ 5/5 æ¸¬è©¦é€šé (100%)
```

### å¯¦éš›æ¸¬è©¦æ¡ˆä¾‹

#### æ¸¬è©¦ 1: G1344 å¸Œè‡˜æ–‡ç·¨è™Ÿæœå°‹

```python
result = await search_bible(
    query="1344",
    search_type="greek_number",
    scope="nt",
    version="unv"
)

# çµæœ
{
    "total_count": 35,
    "results": [
        {"book": "Matt", "chapter": 12, "verse": 37, "text": "...å®šä½ ç‚ºç¾©..."},
        {"book": "Luke", "chapter": 7, "verse": 29, "text": "...ä»¥ç¥ç‚ºç¾©..."},
        {"book": "Acts", "chapter": 13, "verse": 39, "text": "...å¾—ç¨±ç‚ºç¾©..."},
        {"book": "Rom", "chapter": 3, "verse": 24, "text": "...ç™½ç™½çš„ç¨±ç¾©..."},
        ...
    ]
}
```

**é©—è­‰é€šé**: âœ… æ‰¾åˆ°å¯¦éš›è–ç¶“ç¶“æ–‡ï¼ŒåŒ…å«æ¸¬è©¦å ±å‘Šä¸­æåˆ°çš„é—œéµç¶“æ–‡

#### æ¸¬è©¦ 2: H430 å¸Œä¼¯ä¾†æ–‡ç·¨è™Ÿæœå°‹

```python
result = await search_bible(
    query="430",
    search_type="hebrew_number",
    scope="ot",
    version="unv"
)

# çµæœ
{
    "total_count": 20,
    "results": [
        {"book": "Gen", "chapter": 1, "verse": 1, "text": "èµ·åˆç¥å‰µé€ å¤©åœ°..."},
        {"book": "Gen", "chapter": 1, "verse": 2, "text": "ç¥çš„éˆé‹è¡Œ..."},
        ...
    ]
}
```

**é©—è­‰é€šé**: âœ… æ‰¾åˆ°å‰µä¸–è¨˜ 1:1 ç­‰é—œéµç¶“æ–‡

---

## ğŸ“Š æ¸¬è©¦è¦†è“‹ç¯„åœ

### åŠŸèƒ½æ¸¬è©¦

| æ¸¬è©¦é …ç›®               | ç‹€æ…‹ | èªªæ˜                                        |
| ---------------------- | ---- | ------------------------------------------- |
| greek_number åŸºæœ¬æœå°‹  | âœ…    | G1344 è¿”å› 35 è™•çµæœ                        |
| hebrew_number åŸºæœ¬æœå°‹ | âœ…    | H430 è¿”å› 20 è™•çµæœï¼ˆå«å‰µ 1:1ï¼‰             |
| search_type åƒæ•¸é©—è­‰   | âœ…    | keyword/greek_number/hebrew_number å…¨éƒ¨æ¥å— |
| å®Œæ•´ç¶“æ–‡åˆ—è¡¨é©—è­‰       | âœ…    | ç¢ºèªåŒ…å«æ¸¬è©¦å ±å‘Šæåˆ°çš„ç¶“æ–‡                  |
| ç¶“æ–‡å…§å®¹è³ªé‡é©—è­‰       | âœ…    | æ‰€æœ‰å¿…è¦æ¬„ä½å®Œæ•´ä¸”æœ‰æ•ˆ                      |

### å›æ­¸æ¸¬è©¦

| åŠŸèƒ½               | v0.1.2 å‰ | v0.1.2 å¾Œ |
| ------------------ | --------- | --------- |
| keyword æœå°‹       | âœ…         | âœ…         |
| greek_number æœå°‹  | âŒ         | âœ…         |
| hebrew_number æœå°‹ | âŒ         | âœ…         |

---

## ğŸ”— ç›¸é—œå•é¡Œ

### ä¿®å¾©æ­·å²

- **P1-4**: lookup_strongs å¤šæ ¼å¼æ”¯æ´ï¼ˆv0.1.2 å·²ä¿®å¾©ï¼‰
- **P1-5**: search_strongs_occurrences 0 çµæœï¼ˆv0.1.2 å·²ä¿®å¾©ï¼‰
- **P1-6**: search_bible åƒæ•¸é©—è­‰å¤±æ•—ï¼ˆæœ¬æ¬¡ä¿®å¾©ï¼‰

### å•é¡Œé—œè¯

é€™ä¸‰å€‹å•é¡Œéƒ½èˆ‡ Strong's åŸæ–‡ç·¨è™ŸåŠŸèƒ½ç›¸é—œï¼š

1. **P1-4**: lookup_strongs ç„¡æ³•æ¥å— G/H å‰ç¶´ â†’ å·²ä¿®å¾©ï¼ˆv0.1.2ï¼‰
2. **P1-5**: search_strongs_occurrences æœå°‹çµæœç‚º 0 â†’ å·²ä¿®å¾©ï¼ˆv0.1.2ï¼‰
3. **P1-6**: search_bible ç„¡æ³•ä½¿ç”¨ greek_number/hebrew_number â†’ **æœ¬æ¬¡ä¿®å¾©**

---

## ğŸ’¡ æŠ€è¡“ç´°ç¯€

### MCP å·¥å…·å®šç¾©è¦ç¯„

```python
# MCP Tool Schema å¿…é ˆèˆ‡å¯¦ç¾ä¸€è‡´
Tool(
    name="function_name",
    inputSchema={
        "properties": {
            "param_name": {
                "enum": ["value1", "value2"],  # âš ï¸ å¿…é ˆèˆ‡å¯¦ç¾çš„é©—è­‰é‚è¼¯ä¸€è‡´
            }
        }
    }
)

# å°æ‡‰çš„å¯¦ç¾
async def function_name(param_name: str):
    valid_values = {"value1", "value2"}  # âš ï¸ å¿…é ˆèˆ‡ enum ä¸€è‡´
    if param_name not in valid_values:
        raise ValueError(...)
```

### æœ€ä½³å¯¦è¸

1. **é›†ä¸­ç®¡ç†æšèˆ‰**: è€ƒæ…®å°‡å¸¸ç”¨æšèˆ‰å€¼å®šç¾©ç‚ºå¸¸é‡
2. **è‡ªå‹•é©—è­‰**: ä½¿ç”¨å·¥å…·æª¢æŸ¥ MCP schema èˆ‡å¯¦ç¾çš„ä¸€è‡´æ€§
3. **æ–‡æª”åŒæ­¥**: æ›´æ–°å¯¦ç¾æ™‚åŒæ­¥æ›´æ–° MCP å·¥å…·å®šç¾©

---

## ğŸ“ å¾ŒçºŒå»ºè­°

### çŸ­æœŸæ”¹é€²

1. **å¢åŠ æ›´å¤šæ¸¬è©¦**: è¦†è“‹é‚Šç•Œæƒ…æ³ï¼ˆç©ºå­—ä¸²ã€ç‰¹æ®Šå­—ç¬¦ï¼‰
2. **æ”¹å–„éŒ¯èª¤è¨Šæ¯**: ç•¶åƒæ•¸éŒ¯èª¤æ™‚ï¼Œåˆ—å‡ºå…è¨±çš„å€¼
3. **æ–‡æª”æ›´æ–°**: åœ¨ API.md ä¸­æ˜ç¢ºèªªæ˜ search_type çš„æœ‰æ•ˆå€¼

### é•·æœŸæ”¹é€²

1. **è‡ªå‹•åŒ–æª¢æŸ¥**: CI æµç¨‹ä¸­åŠ å…¥ MCP schema ä¸€è‡´æ€§æª¢æŸ¥
2. **å‹åˆ¥å®‰å…¨**: ä½¿ç”¨ TypedDict æˆ– Pydantic å®šç¾©åƒæ•¸çµæ§‹
3. **çµ±ä¸€éŒ¯èª¤è™•ç†**: ç‚ºæ‰€æœ‰å·¥å…·æä¾›ä¸€è‡´çš„åƒæ•¸é©—è­‰é‚è¼¯

---

## âœ… ä¿®å¾©ç¢ºèª

### æª¢æŸ¥æ¸…å–®

- [x] ä¿®æ”¹ server.py ä¸­çš„ search_bible å·¥å…·å®šç¾©
- [x] å‰µå»º 5 å€‹æ¸¬è©¦ç”¨ä¾‹é©—è­‰åŠŸèƒ½
- [x] æ‰€æœ‰æ¸¬è©¦é€šéï¼ˆ5/5, 100%ï¼‰
- [x] G1344 æœå°‹è¿”å›å¯¦éš›ç¶“æ–‡ï¼ˆ35 è™•ï¼‰
- [x] H430 æœå°‹è¿”å›å¯¦éš›ç¶“æ–‡ï¼ˆ20 è™•ï¼‰
- [x] ç¢ºèªåŒ…å«æ¸¬è©¦å ±å‘Šæåˆ°çš„é—œéµç¶“æ–‡
- [x] å‘å¾Œå…¼å®¹ keyword æœå°‹
- [x] å‰µå»ºæœ¬ä¿®å¾©å ±å‘Š

### é©—è­‰æ–¹æ³•

```bash
# æ–¹æ³• 1: å¿«é€Ÿé©—è­‰è…³æœ¬
python tests/test_search_bible_numbers.py

# æ–¹æ³• 2: pytest å®Œæ•´æ¸¬è©¦
pytest tests/test_search_bible_numbers.py -v

# æ–¹æ³• 3: åœ¨ Claude Desktop ä¸­æ¸¬è©¦
"æœå°‹ Strong's G1344 åœ¨è–ç¶“ä¸­çš„å‡ºç¾"
"æŸ¥æ‰¾ H430 åœ¨èˆŠç´„çš„æ‰€æœ‰ä½ç½®"
```

---

## ğŸ“Š å½±éŸ¿è©•ä¼°

### ä¿®å¾©å‰

- **å¯ç”¨åŠŸèƒ½**: é—œéµå­—æœå°‹ï¼ˆkeywordï¼‰
- **ä¸å¯ç”¨**: å¸Œè‡˜æ–‡ç·¨è™Ÿæœå°‹ã€å¸Œä¼¯ä¾†æ–‡ç·¨è™Ÿæœå°‹
- **ç”¨æˆ¶é«”é©—**: ç„¡æ³•ä½¿ç”¨åŸæ–‡ç·¨è™Ÿé€²è¡Œè–ç¶“æœå°‹

### ä¿®å¾©å¾Œ

- **å¯ç”¨åŠŸèƒ½**: é—œéµå­—æœå°‹ + å¸Œè‡˜æ–‡ç·¨è™Ÿæœå°‹ + å¸Œä¼¯ä¾†æ–‡ç·¨è™Ÿæœå°‹
- **æ¸¬è©¦é€šéç‡**: 5/5 (100%)
- **ç”¨æˆ¶é«”é©—**: å®Œæ•´çš„åŸæ–‡ç·¨è™Ÿæœå°‹åŠŸèƒ½ï¼Œæ”¯æ´ G1344, H430 ç­‰æ ¼å¼

---

## ğŸ‰ ç¸½çµ

**å•é¡Œ**: search_bible çš„ MCP å·¥å…·å®šç¾©èˆ‡å¯¦ç¾ä¸ä¸€è‡´ï¼Œå°è‡´ greek_number/hebrew_number åƒæ•¸é©—è­‰å¤±æ•—

**ä¿®å¾©**: æ›´æ–° server.py ä¸­çš„æšèˆ‰å€¼ï¼Œå¾ `["keyword", "greek", "hebrew"]` æ”¹ç‚º `["keyword", "greek_number", "hebrew_number"]`

**çµæœ**: 
- âœ… æ‰€æœ‰ 5 å€‹æ¸¬è©¦é€šé
- âœ… G1344 æœå°‹è¿”å› 35 è™•å‡ºç¾
- âœ… H430 æœå°‹è¿”å› 20 è™•å‡ºç¾ï¼ˆå«å‰µ 1:1ï¼‰
- âœ… 100% å‘å¾Œå…¼å®¹

**ç‹€æ…‹**: âœ… å·²å®Œæˆä¸¦é©—è­‰

---

**å ±å‘Šå‰µå»º**: 2025-11-05  
**æœ€å¾Œæ›´æ–°**: 2025-11-05  
**ç›¸é—œæª”æ¡ˆ**: 
- `src/fhl_bible_mcp/server.py` (ä¿®å¾©)
- `tests/test_search_bible_numbers.py` (æ¸¬è©¦)
- `tests/check_search_format.py` (é©—è­‰è…³æœ¬)
